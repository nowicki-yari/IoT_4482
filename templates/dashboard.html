{% extends "bootstrap/base.html" %}
{% block title %}Flask-MQTT example{% endblock %}

{% block styles %}
{{ super() }}
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<!-- CHARTS MIS JS scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
    const ctx = document.getElementById('temperature_chart').getContext('2d');
    const myChart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Temperature',
                data: []
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    ticks: {
                        autoSkip: true,
                        maxTicksLimit: 10
                    }
                }],
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
        }
    });
    $(document).ready(function() {
        //var socket = io.connect('http://' + document.domain + ':' + location.port, {secure: true});
        var socket = io.connect('/');
        socket.on('mqtt_message', function(data) {
            const d = new Date();
            let time = d.toLocaleTimeString();
            addData(myChart, time, data['payload']);
        })
    });

    function addData(chart, label, data) {
        chart.data.labels.push(label);
        chart.data.datasets.forEach((dataset) => {
            dataset.data.push(data);
        });
        chart.update();
    }


</script>
{% endblock %}

{% block content %}
<link href= "{{ url_for('static',filename='styles/app.css') }}" rel="stylesheet"/>
<div class="form-group">
    <div class="grid-container">
        <div class="item1">
            <h1>Weather station</h1>
            <hr>
        </div>
        <div class="item2">
            <h2>Navigation menu</h2>
        </div>
        <div class="item3">
            <br>
            <canvas id="temperature_chart"></canvas>
        </div>
        <div class="item4">
            <h2>Menu right side</h2>
        </div>
        <div class="item5">
            <h5>Footer</h5>
        </div>
    </div>
</div>
{% endblock %}